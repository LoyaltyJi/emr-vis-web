<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="en" ng-app="myApp" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html lang="en" ng-app="myApp" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html lang="en" ng-app="myApp" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en" ng-app="myApp" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>EMR VisWeb</title>

  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="stylesheet" href="bower_components/html5-boilerplate/css/normalize.css">
  <link rel="stylesheet" href="bower_components/html5-boilerplate/css/main.css">
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="css/app.css"/>
  <link rel="stylesheet" type="text/css" href="css/wordtree-style.css">

  <script src="bower_components/html5-boilerplate/js/vendor/modernizr-2.6.2.min.js"></script>
</head>

<body class="ng-cloak" ng-controller="MainCtrl">

  <div ng-show="appDisabled" id="coverall">
  </div>
  
  <div ng-show="appLoading" id="appLoading" class="alert alert-warning appNotice">
    <strong>Loading!</strong> Please wait.
  </div>

  <!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
  <![endif]-->
  
  <header class="navbar navbar-default navbar-fixed-top">
    <div class="navbar-header">
      <a class="navbar-brand visible-xs">EMR VisWeb</a>
    </div>
    <nav class="hidden-xs">
      <ul class="nav navbar-nav">
        <a href="#top" role="button" class="navbar-brand">
          EMR VisWeb
        </a>
        <li><a class="dropdown-toggle" href="#/">DATASET <i class="glyphicon glyphicon-chevron-down"></i></a></li>
        <li><a class="dropdown-toggle" href="#/">MODEL <i class="glyphicon glyphicon-chevron-down"></i></a></li>
      </ul>
      <form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <span class="add-on">Doc #</span>
          <input class="form-control" type="search" ng-model="searchQuery" /><span id="searchclear" class="searchclear glyphicon glyphicon-remove-circle" ng-click="searchQuery = ''"></span>
        </div>
      </form>
    </nav>
  </header>

<!-- Main container starts here. -->

  <div class="container-fluid">
      <div class="row">
        <div class="sidebar">
          <div id="sidebar-resize-indicator"></div>
          <div id="sidebar-top" class="unselectable">
            <div id="tablecontainer">
              <div id="topbar">
                <div tooltip-placement="right" tooltip-animation="false" tooltip="document identifier" class="colname cellwidth_id">
                  <div class="progress">
                  </div>
                  <a class="rotate"><div>doc #</div></a>
                </div>
                <div class="colname cellwidth_var" ng-repeat="var in variables" tooltip="{{variableData[var]['percPositive']}}% {{classificationName['positive']}}" tooltip-placement="{{$index > 6 ? 'left' : 'right'}}">
                  <div class="progress">
                    <div class="progress-bar positive" style="width: {{variableData[var]['percPositive']}}%"></div>
                    <div class="progress-bar negative" style="width: {{variableData[var]['percNegative']}}%"></div>
                  </div>
                  <a class="rotate"><div>{{variableMapping[var]}}</div></a>
                </div>
              </div>
              <div class="sidebar-separator breakline" horizontal-splitter>
                <div class="handle"></div>
              </div>
              <div id="expandtable">
                <div class="divrow ng-cloak" ng-repeat="doc in gridData | filter: { id: searchQuery }">
                  <div class="divcell cellwidth_id">{{doc.id}}</div>
                  <div ng-repeat="var in variables" class="divcell cellwidth_var {{styleGridCell(doc[var].classification, doc[var].confidence)}} custom-tooltip-bottom" ng-click="updateGrid(var, $parent.$index)" ng-class="{selected: $parent.$index==active.docIndex && var==active.variable}" data-custom-tooltip="{{doc[var].confidence}}">
                    {{classificationName[ doc[var].classification ]}}
                  </div>
                </div>
              </div>
            </div>
          </div>  
          
          <div class="sidebar-separator" horizontal-splitter>
            <div class="handle"></div>
          </div>

          <div id="sidebar-bottom">
            
            <div id="sidebar-bottom-left">
              <div class="about unselectable">Variable details: <strong>{{variableMapping[active.variable]}}</strong></div>
              <div class="content">
                <div id="keywords">
                  <h6>{{classificationName["positive"]}} indicators</h6>
                  <p ng-hide="variableData[active.variable].topPositive.length" class="empty-list">None</p>
                  <ol>
                    <li ng-repeat="keyword in variableData[active.variable].topPositive" class="positive" style="width:{{keyword.weight*100}}%;" >{{keyword.term}}&nbsp;<span class="d3-tip">({{keyword.weight}})</span></li>
                  </ol>

                  <h6>{{classificationName["negative"]}} indicators</h6>
                  <p ng-hide="variableData[active.variable].topNegative.length" class="empty-list">None</p>
                  <ol>
                    <li ng-repeat="keyword in variableData[active.variable].topNegative" class="negative" style="width:{{keyword.weight*100}}%;">{{keyword.term}}&nbsp;<span class="d3-tip">({{keyword.weight}})</span></li>
                  </ol>
                </div>
                <div id="distribution">
                  <h6>Distribution</h6>
                  <p ng-hide="pieData" class="empty-list">None</p>
                  <d3-piechart ng-show="pieData" data='pieData'></d3-piechart>
                </div>
              </div>
            </div>

            <div id="sidebar-bottom-right">
              <div class="about unselectable">Report: <strong>#{{gridData[active.docIndex].id}}</strong></div>
              
              <div class="content">
                <h6>{{classificationName["positive"]}} indicators</h6>
                <p ng-hide="gridData[active.docIndex][active.variable].topPositive.length" class="empty-list">None</p>
                <ol>
                  <li ng-repeat="keyword in gridData[active.docIndex][active.variable].topPositive"  class="positive clickable" style="width:{{keyword.weight*100}}%;" scroll-to-bookmark="{{keyword.term}}">{{keyword.term}}&nbsp;<span class="d3-tip">({{keyword.weight}})</span></li>
                </ol>

                <h6>{{classificationName["negative"]}} indicators</h6>
                <p ng-hide="gridData[active.docIndex][active.variable].topNegative.length" class="empty-list">None</p>
                <ol>
                  <li ng-repeat="keyword in gridData[active.docIndex][active.variable].topNegative" class="negative clickable" scroll-to-bookmark="{{keyword.term}}" style="width:{{keyword.weight*100}}%;">{{keyword.term}}&nbsp;<span class="d3-tip">({{keyword.weight}})</span></li>
                </ol>
              </div>

            </div>
          
          </div>
        </div>
        <div class="main">
          <div>
            <div ng-if="records.report.exists && tabs.docView" class="alert alert-warning reportFeedback">
              <span ng-if="appInfo">
                {{appInfo}}
              </span>
              <span ng-if="!appInfo">
                <span ng-if="feedbackText"><em>"{{feedbackText|truncate:20}}"</em> indicates <strong>{{variableMapping[active.variable]}}</strong> to be: <a ng-click="addFeedbackText('positive')">{{classificationName['positive']}}</a> | <a ng-click="addFeedbackText('negative')">{{classificationName['negative']}}</a></span>
                <span ng-if="!feedbackText" ><strong>{{variableMapping[active.variable]}}</strong> is marked as <strong>{{classificationName[ gridData[active.docIndex][active.variable].classification ] | lowercase}}</strong> for this record. Label it as: <a ng-click="addFeedbackDoc('positive')">{{classificationName['positive']}}</a> | <a ng-click="addFeedbackDoc('negative')">{{classificationName['negative']}}</a></span>
              </span>
            </div>
            <div ng-if="wordTreeData.feedbackText && tabs.wordTreeView" class="alert alert-warning reportFeedback">
              <span ng-if="appInfo">
                {{appInfo}}
              </span>
              <span ng-if="!appInfo">
                <em>"{{wordTreeData.feedbackText|truncate:20}}"</em> indicates <select ng-init="wordTreeData.feedbackVar = active.variable" ng-model="wordTreeData.feedbackVar" ng-options="variableMapping[var] for var in variables"></select> to be: <a ng-click="addWordTreeFeedback('positive')">{{classificationName['positive']}}</a> | <a ng-click="addWordTreeFeedback('negative')">{{classificationName['negative']}}</a>
              </span>
            </div>
            <tabset>
              <tab active="tabs.docView" heading="Document View">
                <div ng-show="records.pathology.exists" class="pagerview">
                  <div class="pagerview-row">
                      <div class="pagerview-step">
                          <button type="button" scroll-to-bookmark="records.report.text" class="btn btn-default btn-circle">1</button>
                          <p class="clickable" scroll-to-bookmark="records.report.text">Report</p>
                      </div>
                      <div class="pagerview-step">
                          <button type="button" scroll-to-bookmark="records.pathology.text" class="btn btn-default btn-circle">2</button>
                          <p class="clickable" scroll-to-bookmark="records.pathology.text">Pathology</p>
                      </div>
                  </div>
                </div>
                <div scroll-bookmark="records.report.text" ng-mouseup="setFeedbackText()" ng-if="records.report.exists" id="emr-report" class="report">
                  <div class="info">
                    <i class="glyphicon glyphicon-list-alt"></i>&nbsp;
                    <a tooltip-placement="bottom" tooltip-animation="false" tooltip="docs/{{gridData[active.docIndex].id}}/report.txt">
                      <strong class="file-name js-selectable-text">Report: #{{gridData[active.docIndex].id}}</strong>
                    </a>
                    <a class="btn btn-xs btn-default pull-right" ng-click="PrintReport('emr-report')"><strong>Print</strong></a>
                  </div>
                  <pre><highlighted-report data='records.report.text' pos-terms='gridData[active.docIndex][active.variable].topPositive' neg-terms='gridData[active.docIndex][active.variable].topNegative'></highlighted-report></pre>
                </div>
                <div scroll-bookmark="records.pathology.text" ng-mouseup="setFeedbackText()" ng-if="records.pathology.exists" id="emr-pathology" class="report">
                  <div class="info">
                    <i class="glyphicon glyphicon-list-alt"></i>&nbsp;
                    <a tooltip-placement="bottom" tooltip-animation="false" tooltip="docs/{{gridData[active.docIndex].id}}/pathology.txt"> 
                      <strong class="file-name js-selectable-text">Pathology: #{{gridData[active.docIndex].id}}</strong>
                    </a>
                    <a class="btn btn-xs btn-default pull-right" ng-click="PrintReport('emr-pathology')"><strong>Print</strong></a>
                  </div>
                  <pre><highlighted-report data='records.pathology.text' pos-terms='gridData[active.docIndex][active.variable].topPositive' neg-terms='gridData[active.docIndex][active.variable].topNegative' ></highlighted-report></pre>
                </div>
                <!-- div id="pathology-report" class>
                </div> -->
              </tab>
              <tab active="tabs.wordTreeView" select="setWordTreeHeight()" heading="WordTree View">
                <form ng-submit="loadWordTree(wordTreeQuery)" id="wordtree-search">
                  <div class="row">
                    <div class="input-group">
                      <input type="text" ng-model="wordTreeQuery" class="form-control" placeholder="Enter keywords&hellip;">
                      <span class="input-group-btn">
                          <button type="submit" class="btn btn-default">Search</button>
                      </span>
                    </div>
                  </div>
                </form>
                <div id="wordtree-view">
                  <div id="wordtree-container" class="wordtree-container-class">
                    <p id="wordtree-empty">
                      No wordtree to show. Enter keywords above and search.
                    </p>
                  </div>
                </div>
                <div ng-show="wordTreeData.matches" id="wordtree-about" class="unselectable">Documents: <strong> {{wordTreeData.matches}}/{{wordTreeData.total}} ({{wordTreeData.percentage}}%)</strong></div>
                <div id="wordtree-fullscreen-button">
                  <button type="button" class="btn btn-sm btn-default" ng-model="singleModel" btn-checkbox ng-click="toggleWordTreeFullscreen()">
                  <span class="glyphicon glyphicon-fullscreen"></span>
                  </button>
                </div>
              </tab>
              <tab>
                <tab-heading>
                  Feedback Review &nbsp;<span ng-if="feedbackList.length > 0" class="badge alert-info pull-right"> {{feedbackList.length}} </span>
                </tab-heading>
                <div class="feedback-content">
                  <h4>Feedback List</h4>
                  <div id="feedbackList">
                    <p ng-hide="feedbackList.length">Feedback list is empty.</p>
                    <alert ng-repeat="feedback in feedbackList" type="default" close="removeFeedback($index)">
                      <strong>{{$index + 1}}.</strong>
                      <span ng-if="feedback.kind == 0">
                        #{{feedback.property}} should have <strong>{{variableMapping[feedback.variable]}}</strong> marked as <strong>{{classificationName[feedback.classification] | lowercase}}</strong>.
                      </span>
                      <span ng-if="feedback.kind == 1">
                        "<em>{{feedback.property}}</em>" indicates <strong>{{variableMapping[feedback.variable]}}</strong> to be <strong>{{classificationName[feedback.classification] | lowercase}}</strong>.
                      </span>
                    </alert>
                  </div>
                </div>
              </tab>
              <tab select="alertMe()">
                <tab-heading>
                  <i class="glyphicon glyphicon-refresh"></i> Re-Train
                </tab-heading>
                <h4>Training results</h4>
              </tab>
            </tabset>
          </div>

      </div>
    </div>
  </div>

  <!-- In production use:
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/x.x.x/angular.min.js"></script>
  -->
  <!-- Do not change the order -->
  <script src="bower_components/angular/angular.js"></script>
  <!-- <script src="bower_components/angular-route/angular-route.js"></script> -->
  <script src="bower_components/angular-bootstrap/ui-bootstrap-tpls.min.js"></script>
  <script src="bower_components/jquery/dist/jquery.min.js"></script>
  <script src="bower_components/d3/d3.min.js"></script>
  <script src="bower_components/jquery.scrollTo/jquery.scrollTo.min.js"></script>
  <script src="js/app.js"></script>
  <script src="js/services.js"></script>
  <script src="js/controllers.js"></script>
  <script src="js/filters.js"></script>
  <script src="js/directives.js"></script>
  <script src="js/report-highlight.js"></script>
  <script src="js/jquery-routines.js"></script>
  <!-- After angular controllers -->
  <script src="js/wordtree-controller.js"></script> 
  <script src="js/wordtree-layout.js"></script> 
  <script src="js/wordtree-interface.js"></script> 
  <!-- After wordtree-controller -->

  <!-- <script type="text/javascript" src="wordtree-javafx-interface.js"></script> -->
        
</body>
</html>
  